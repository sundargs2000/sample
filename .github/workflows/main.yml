name: CI
on:
  [push]

jobs:
  deploy: 
    runs-on: ubuntu-latest

    steps:
    - name: checkout 
      uses: actions/checkout@v2

    - name: k8-setup
      uses: azure/k8s-set-context@v1
      with:
        method: kubeconfig
        kubeconfig: ${{ secrets.KUBE_CONFIG }} 
      id: setcontext
      
      #     service
    - name: deployer
      uses: sundargs2000/k8s-deploy@reviews
      with:
        namespace: smi-demo
        images: tsugunt/example:v1
        manifests: |
          manifests/van/deployment.yml
          manifests/van/service.yml
        strategy: blue-green
        route-method: smi
        action: deploy
  
  
#         #smi  
#     - name: k8-deployer
#       uses: sundargs2000/k8s-deploy@reviews
#       with:
#         namespace: voting
#         images: mcr.microsoft.com/aks/samples/voting/analytics:1.0
#         manifests: |
#           pod.yml
#         strategy: blue-green
#         route-method: smi
#         action: deploy
    





#         #ingress
#     - name: deployer
#       uses: sundargs2000/k8s-deploy@reviews
#       with:
#         namespace: ingress-basic
#         images: tsugunt/sample:v2.4
#         manifests: |
#          manifests/ingress/deployment.yml
#          manifests/ingress/service.yml
#          manifests/ingress/ingress.yml
#         strategy: blue-green
#         route-method: ingress
#         action: deploy

#     env:
#       dock_image: tsugunt/example:v1
#       kube_ns: smi-demo

#     - name: Create an issue
#       run: |
#         token=${{ secrets.GITHUB_TOKEN }}
#         curl -d '{"title": "Action needed", "body": "Edit title to promote-bg or reject-bg", "labels": [ "${{env.dock_image}}",  "${{env.kube_ns}}"] }' -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" -H "Content-Type: application/json" -H "Accept: application/vnd.github.antiope-preview+json" https://api.github.com/repos/sundargs2000/sample/issues
